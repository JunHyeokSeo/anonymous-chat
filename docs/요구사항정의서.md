# 요구사항 정의서

## 1. 개요

본 문서는 '익명 채팅 애플리케이션'의 기능적 및 비기능적 요구사항을 정의합니다. 이 시스템은 사용자가 익명으로 다른 사용자와 1:1 대화를 나눌 수 있는 플랫폼을 제공하는 것을 목표로 합니다.

## 2. 기능적 요구사항

### 2.1. 사용자 관리
- **FR-U-01**: 사용자는 Google, Naver, Kakao 계정을 사용하여 OAuth2 기반으로 시스템에 로그인할 수 있어야 한다.
- **FR-U-02**: 시스템에 처음 로그인하는 사용자는 'GUEST' 권한을 가지며, 추가 정보(닉네임, 성별, 나이, 지역 등)를 입력하여 'USER' 권한으로 전환(회원가입)할 수 있어야 한다.
- **FR-U-03**: 닉네임은 시스템 내에서 고유해야 하며, 중복될 수 없다.
- **FR-U-04**: 사용자는 자신의 프로필 정보(닉네임, 성별, 나이, 지역, 자기소개)를 조회하고 수정할 수 있어야 한다.
- **FR-U-05**: 사용자는 최대 3개의 프로필 이미지를 업로드하고 관리할 수 있으며, 그중 하나를 대표 이미지로 설정할 수 있어야 한다.
- **FR-U-06**: 사용자는 시스템에서 탈퇴할 수 있으며, 탈퇴 시 개인 정보는 비활성화 처리된다.
- **FR-U-07**: 사용자는 다른 사용자를 검색 조건(성별, 나이대, 지역)에 따라 필터링하여 조회할 수 있어야 한다.
- **FR-U-08**: 사용자는 다른 사용자를 차단하여 상호 간의 프로필 노출 및 채팅을 막을 수 있어야 한다.
- **FR-U-09**: 사용자는 차단한 사용자를 다시 차단 해제할 수 있어야 한다.

### 2.2. 채팅
- **FR-C-01**: 사용자는 다른 사용자와 1:1 채팅방을 생성할 수 있어야 한다.
- **FR-C-02**: 이미 상대방과 채팅방이 존재하는 경우, 새로운 방을 만들지 않고 기존 채팅방을 반환해야 한다.
- **FR-C-03**: 사용자는 자신이 참여 중인 채팅방 목록을 조회할 수 있어야 한다. 목록에는 상대방 정보, 마지막 메시지, 안 읽은 메시지 수가 포함되어야 한다.
- **FR-C-04**: 사용자는 WebSocket을 통해 채팅방에 실시간으로 메시지를 전송하고 수신할 수 있어야 한다.
- **FR-C-05**: 사용자는 채팅방의 이전 대화 내용을 페이징하여 조회할 수 있어야 한다.
- **FR-C-06**: 메시지 읽음 처리가 되어야 하며, 상대방이 마지막으로 읽은 메시지를 확인할 수 있어야 한다.
- **FR-C-07**: 사용자는 참여 중인 채팅방에서 나갈 수 있다.

### 2.3. 인증 및 인가
- **FR-A-01**: 모든 API 요청은 JWT(Access Token) 기반으로 인증되어야 한다.
- **FR-A-02**: Access Token이 만료된 경우, Refresh Token을 사용하여 새로운 Access Token을 발급받을 수 있어야 한다.
- **FR-A-03**: 로그아웃 시 서버에 저장된 Refresh Token은 무효화되고, 사용 중인 Access Token은 블랙리스트에 등록되어야 한다.
- **FR-A-04**: API 접근은 사용자의 역할(GUEST, USER, ADMIN)에 따라 통제되어야 한다.

## 3. 비기능적 요구사항

### 3.1. 성능
- **NFR-P-01**: 일반적인 API 요청(DB 조회)은 200ms 이내에 응답해야 한다.
- **NFR-P-02**: WebSocket 메시지 브로드캐스트 지연 시간은 100ms 이하여야 한다.
- **NFR-P-03**: 초당 최소 20개의 채팅 메시지를 처리할 수 있어야 한다. (사용자당 레이트 리밋 적용)

### 3.2. 보안
- **NFR-S-01**: 모든 사용자 비밀번호 및 민감한 정보는 시스템에 저장하지 않는다 (OAuth2 위임).
- **NFR-S-02**: JWT 토큰은 안전한 시크릿 키로 서명되어야 하며, HTTPS를 통해서만 전송되어야 한다.
- **NFR-S-03**: 파일 업로드 시 이미지 파일(JPG, PNG, GIF)만 허용하며, 파일 확장자 및 MIME 타입을 검증해야 한다.

### 3.3. 가용성 및 확장성
- **NFR-A-01**: 시스템은 99.9%의 가용성을 목표로 한다.
- **NFR-A-02**: Redis와 같은 외부 저장소를 사용하여 토큰을 관리함으로써, 서버를 수평적으로 확장할 수 있는 구조여야 한다.

### 3.4. 데이터 관리
- **NFR-D-01**: 사용자가 탈퇴하더라도 법적 요구사항 및 데이터 분석을 위해 사용자 데이터는 즉시 물리적으로 삭제되지 않고, '비활성' 상태로 유지되어야 한다.
